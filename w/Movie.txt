CREATE TABLE ACTOR (ACT_ID INT, ACT_NAME VARCHAR(20), ACT_GENDER CHAR, PRIMARY KEY(ACT_ID));

CREATE TABLE DIRECTOR (DIR_ID INT, DIR_NAME VARCHAR(20), DIR_PHONE BIGINT, PRIMARY KEY (DIR_ID));

CREATE TABLE MOVIES (MOV_ID INT, MOV_TITLE VARCHAR(20), MOV_YEAR INT, MOV_LANG VARCHAR(20), DIR_ID INT, PRIMARY KEY (MOV_ID), FOREIGN KEY (DIR_ID) REFERENCES DIRECTOR (DIR_ID) ON DELETE CASCADE ON UPDATE CASCADE);

CREATE TABLE MOVIE_CAST (ACT_ID INT, MOV_ID INT, ROLE VARCHAR(20), PRIMARY KEY (ACT_ID, MOV_ID), FOREIGN KEY (ACT_ID) REFERENCES ACTOR(ACT_ID) ON DELETE CASCADE ON UPDATE CASCADE, FOREIGN KEY (MOV_ID) REFERENCES MOVIES(MOV_ID) ON DELETE CASCADE ON UPDATE CASCADE);

CREATE TABLE RATING (MOV_ID INT, REV_STARS INT, PRIMARY KEY(MOV_ID), FOREIGN KEY(MOV_ID) REFERENCES MOVIES(MOV_ID) ON DELETE CASCADE ON UPDATE CASCADE);

INSERT INTO ACTOR VALUES (101, 'SUDDEEP', 'M');
INSERT INTO ACTOR VALUES (102, 'PRABHAS', 'M');
INSERT INTO ACTOR VALUES (103, 'CHRIS HEMSWORTH', 'M');
INSERT INTO ACTOR VALUES (104, 'BENEDICT CUMBERBATCH', 'M');
INSERT INTO ACTOR VALUES (105, 'MILANA NAGRAJ', 'F');

INSERT INTO DIRECTOR VALUES (201, 'TAIKA WAITITI', 2356617781);
INSERT INTO DIRECTOR VALUES (202, 'RAJAMOULI', 2356615474);
INSERT INTO DIRECTOR VALUES (203, 'ANUP BHANDARI', 9379816274);
INSERT INTO DIRECTOR VALUES (204, 'SCOTT DERRICKSON', 9356216474);
INSERT INTO DIRECTOR VALUES (205, 'DIRECTOR X', 1234567890);

INSERT INTO MOVIES VALUES (51, 'VIKRANT RONA', 2022, 'KANNADA', 203);
INSERT INTO MOVIES VALUES (52, 'SPARSHA', 1999, 'KANNADA', 205);
INSERT INTO MOVIES VALUES (53, 'BAHUBALI 1', 2015, 'TELUGU', 202);
INSERT INTO MOVIES VALUES (54, 'RANGITARANGA', 2015, 'KANNADA', 203);
INSERT INTO MOVIES VALUES (55, 'THOR RAGNAROK', 2017, 'ENGLISH', 201);
INSERT INTO MOVIES VALUES (56, 'DOCTOR STRANGE', 2016, 'ENGLISH', 204);

INSERT INTO MOVIE_CAST VALUES (101, 51, 'HERO');
INSERT INTO MOVIE_CAST VALUES (101, 52, 'HERO');
INSERT INTO MOVIE_CAST VALUES (101, 53, 'GUEST');
INSERT INTO MOVIE_CAST VALUES (102, 53, 'HERO');
INSERT INTO MOVIE_CAST VALUES (103, 55, 'HERO');
INSERT INTO MOVIE_CAST VALUES (104, 55, 'GUEST');
INSERT INTO MOVIE_CAST VALUES (104, 56, 'HERO');
INSERT INTO MOVIE_CAST VALUES (105, 51, 'GUEST');

INSERT INTO RATING VALUES (51, 3);
INSERT INTO RATING VALUES (52, 4);
INSERT INTO RATING VALUES (53, 3);
INSERT INTO RATING VALUES (54, 4);
INSERT INTO RATING VALUES (55, 0);
INSERT INTO RATING VALUES (56, 3);

SELECT MOV_TITLE
FROM MOVIES
WHERE DIR_ID IN (SELECT DIR_ID
FROM DIRECTOR
WHERE DIR_NAME='RAJAMOULI');

SELECT MOV_TITLE
FROM MOVIES M, MOVIE_CAST C
WHERE M.MOV_ID=C.MOV_ID AND C.ACT_ID IN (SELECT  ACT_ID
FROM MOVIE_CAST GROUP BY ACT_ID HAVING COUNT(ACT_ID)>1);

SELECT DISTINCT K.ACT_NAME FROM
(SELECT A.ACT_NAME
FROM ACTOR A JOIN MOVIE_CAST M ON A.ACT_ID=M.ACT_ID
JOIN MOVIES M1 ON M.MOV_ID=M1.MOV_ID
WHERE M1.MOV_YEAR<2000) K
INNER JOIN
(SELECT A.ACT_NAME
FROM ACTOR A JOIN MOVIE_CAST M ON A.ACT_ID=M.ACT_ID
JOIN MOVIES M1 ON M.MOV_ID=M1.MOV_ID
WHERE M1.MOV_YEAR>2015) L
ON (K.ACT_NAME=L.ACT_NAME);

SELECT MOV_TITLE, MAX(REV_STARS)
FROM MOVIES
INNER JOIN RATING USING(MOV_ID)
GROUP BY MOV_TITLE
HAVING MAX(REV_STARS)>0
ORDER BY MOV_TITLE;

UPDATE RATING
SET REV_STARS=5
WHERE MOV_ID IN (SELECT MOV_ID FROM MOVIES
WHERE DIR_ID IN (SELECT DIR_ID
FROM DIRECTOR
WHERE DIR_NAME='ANUP BHANDARI'));
